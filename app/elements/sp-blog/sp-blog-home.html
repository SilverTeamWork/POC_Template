<dom-module id="sp-blog-home">
  <template>
    <div class="main wrapper flexitem-fluid application" on-post-selected="_viewPost">
      <iron-pages attr-for-selected="data-page" selected="{{page}}" activate-event="">
        <section data-page="blog-home" class="blog with-aside-app">
          <sp-post-list blog="[[blog]]"></sp-post-list>
        </section>
        <section data-page="post-info" class="blog with-aside-app">
          <sp-post-view post="[[selectedPost]]"></sp-post-view>
        </section>
      </iron-pages>
    </div>
  </template>
</dom-module>

<script>
  (function() {
    Polymer({
      is: 'sp-blog-home',
      properties: {
        blog: {
          type: String,
          observer: '_onBlogChange'
        }
      },
      ready: function() {
        this.page = 'blog-home';
        // reload the list of posts if the blog is reselected so that new posts can be retrieved
        if (app) {
          app.addEventListener('route-changed', function(event) {
            if (event.detail.target === 'sp-app' && event.detail.id === this.blog) {
              this.page = 'blog-home';
            }
          }.bind(this));
          app.addEventListener('page-changed', function(event) {
            if (event.detail.target === 'sp-app' && event.detail.id === this.blog &&
                event.detail.page.type === 'posts') {
              this.selectedPost = event.detail.page.resource;
              this.page = 'post-info';
            }
          }.bind(this));
        }
      },
      _onBlogChange: function() {
        this.page = 'blog-home';
      },
      _viewPost: function(e) {
        e.stopPropagation();
        page('/instances/' + this.blog + '/posts/' + e.detail.post.id, e.detail.post);
      }
    });
  })();
</script>