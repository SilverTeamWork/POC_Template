<link rel="import" href="../sp-breadcrumb/sp-breadcrumb.html">

<dom-module id="sp-space">
  <template>
    <sp-notifier id="msgNotFound" type="error">
      Il n'existe pas d'espace ayant l'identifiant <b><span>{{msgSpaceId}}</span></b>.
    </sp-notifier>

    <sp-service-ajax id="requester"
                     path="[[getSpaceUri(context.spaceId)]]"
                     last-response="{{currentSpace}}"
                     on-error="_spaceNotFound"></sp-service-ajax>
    <div class="main-container flexitem-fluid flexbox-h">
      <sp-space-menu class="flexbox-v" context="[[context]]"></sp-space-menu>
      <div class="main wrapper flexitem-fluid">
        <sp-breadcrumb context="[[context]]"></sp-breadcrumb>
        <section class="space">
          <template is="dom-if" if="[[isSpaceFound]]">
            <h2 class="title"><span>Chez Silverpeas</span></h2>
            Space label: <span id="spaceId">{{currentSpace.label}}</span><br/>
            Space description: <span>{{currentSpace.description}}</span>
          </template>
        </section>
      </div>
    </div>
  </template>
</dom-module>
<script>
  (function() {

    Polymer({
      is : 'sp-space',

      behaviors : [SpaceBehavior, NavigationContextBehavior],

      properties : {

        context : {
          type : Object
        },

        currentSpace : {
          type : Object, notify : true, observer : '_currentSpaceChanged'
        },

        isSpaceFound : {
          type : Boolean, notify : true, readOnly : true
        }
      },

      observers : ['_spaceIdChanged(context.spaceId)'],

      _spaceIdChanged : function() {
        this.$.msgNotFound.hide();
        if (this.isValidSpaceId(this.context.spaceId)) {
          this.$.requester.send();
          console.log("Loading data about the current valid space...");
        }
      },

      _spaceNotFound : function() {
        this.setContextSpace(this.unknownSpace);
        this.currentSpace = null;
        this.msgSpaceId = this.context.spaceId;
        this.$.msgNotFound.show();
        this._currentSpaceChanged();
      },

      _currentSpaceChanged : function() {
        this._setIsSpaceFound(this.isValidSpace(this.currentSpace));
        this._loadParentSpaces(this.currentSpace, function() {
          this.setContextSpace(this.currentSpace);
        });
      }
    });
  })();
</script>
