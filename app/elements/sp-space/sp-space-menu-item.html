<dom-module id="sp-space-menu-item">
  <template>
    <sp-service-ajax id="requester"
                     path="[[getSpaceContentUri(space)]]"
                     last-response="{{spaceContent}}"></sp-service-ajax>
    <a href="{{getSpacePageUrl(space)}}">{{space.label}}</a>
    <template is="dom-if" if="[[spaceContent.length]]">
      <ul>
        <template is="dom-repeat" items="[[spaceContent]]">
          <li>
            <template is="dom-if" if="{{isObjectTypeOfSpace(item)}}">
              <template is="dom-if" if="{{_isSubLevel()}}">
                <sp-space-menu-item space="{{item}}" to-sub-level="{{_nextSubLevel()}}"></sp-space-menu-item>
              </template>
              <template is="dom-if" if="{{!_isSubLevel()}}">
                <a href="{{getSpacePageUrl(item)}}">{{item.label}}</a>
              </template>
            </template>
            <template is="dom-if" if="{{!isObjectTypeOfSpace(item)}}">
              <a href="{{getApplicationInstancePageUrl(item)}}">{{item.label}}</a>
            </template>
          </li>
        </template>
      </ul>
    </template>
  </template>
</dom-module>
<script>
  (function() {

    Polymer({
      is : 'sp-space-menu-item',

      behaviors : [SpaceBehavior],

      properties : {
        space : {
          type : Object, notify : true, value : function() {
            return {
              label : 'unknown'
            };
          }
        },

        toSubLevel : {
          type : Number, value : 0
        }
      },

      ready : function() {
        if (this.space.id != '-1') {
          this.$.requester.send();
        } else {
          this.spaceContent = [];
        }
      },

      _isSubLevel : function() {
        return this.toSubLevel && this.toSubLevel > 0;
      },

      _nextSubLevel : function() {
        return this.toSubLevel - 1;
      }
    });
  })();
</script>
