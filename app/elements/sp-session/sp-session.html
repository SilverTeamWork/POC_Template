<script>
  (function() {
    var SESSION_TOKEN = 'user-auth-token';
    var CURRENT_USER = 'user-profile';
    var LOGIN_PAGE = '/index.html';
    window.SessionBehavior = {
      /**
       * Fires an event if the current user session is valid.
       *
       * @param {Object} currentUser
       * @param {String} currentUser.token the current user session token
       * @param {Object} currentUser.profile the current user profile
       * @event user-session-loaded
       */
      properties : {
        loginPage : {
          type : String, value : LOGIN_PAGE
        }, user : {
          type : Object, notify : true, readOnly: true
        }
      },

      ready : function() {
        var sessionKey = this.sessionKey;
        if (!sessionKey) {
          console.log("no user session key!");
          this._redirectToLoginPage();
        } else {
          this._setUser(this.currentUser);
          this.fire('user-session-loaded', this.user);
        }
      },

      closeSession : function() {
        localStorage.removeItem(SESSION_TOKEN);
        localStorage.removeItem(CURRENT_USER);
        this._redirectToLoginPage();
      },

      get sessionKey() {
        return localStorage.getItem(SESSION_TOKEN);
      },

      get currentUser() {
        return JSON.parse(localStorage.getItem(CURRENT_USER));
      },

      _redirectToLoginPage: function() {
        console.log("redirect to " + this.loginPage);
        document.location = this.loginPage;
      }
    };
  })();
</script>