<dom-module id="sp-app-instance">
  <template>
    <sp-service-ajax id="requester"
                     path="[[getApplicationInstanceUri(instanceId)]]"
                     last-response="{{applicationInstance}}"
                     last-error="{{lastError}}"
                     on-response="_applicationInstanceLoaded"></sp-service-ajax>
    <template is="dom-if" if="{{isApplicationNameEqualTo(applicationInstance, 'blog')}}">
      <sp-blog-home blog="{{instanceId}}"></sp-blog-home>
    </template>

    <template is="dom-if" if="{{_isApplicationNotHandled(applicationInstance)}}">
      <div>Application <b><span>{{applicationInstance.name}}</span></b> is not yet handled.</div>
    </template>

    <template is="dom-if" if="{{_isApplicationNotFound(lastError)}}">
      <div>Application with identifier <b><span>{{instanceId}}</span></b> does not exist, asshole.
      </div>
    </template>
  </template>
</dom-module>
<script>
  (function() {

    Polymer({
      is : 'sp-app-instance',

      behaviors : [ApplicationInstanceBehavior],

      properties : {

        instanceId : {
          type : String, notify : true, observer : '_instanceIdChanged'
        }
      },

      created : function() {
        this.handledApplications = [];
        var map = this.handledApplications;
        map['blog'] = true;
      },

      _instanceIdChanged : function() {
        if (this.isValidApplicationInstanceId(this.instanceId)) {
          this.$.requester.send();
        }
      },

      _isApplicationNotHandled : function(applicationInstance) {
        return (typeof applicationInstance === 'object') &&
            !this.handledApplications[applicationInstance.name];
      },

      _isApplicationNotFound : function(lastError) {
        return (typeof lastError === 'object');
      },

      _applicationInstanceLoaded : function() {
        this.lastError = undefined;
      }
    });
  })();
</script>
