<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <title>POC > Accueil</title>
  <meta name="description" content=""/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="apple-touch-icon" href="images/touch/apple-touch-icon.png"/>
  <link rel="icon" href="favicon.ico" sizes="16x16" type="image/vnd.microsoft.icon">
  <link rel="stylesheet" type="text/css" href="styles/styles.css"/>
  <script src="bower_components/webcomponentsjs/webcomponents.js"></script>
  <script src="bower_components/page/page.js"></script>
  <link rel="import" href="elements/elements.html">
  <script type="text/javascript" src="scripts/jquery/jquery-1.10.2.min.js"></script>
  <script type="text/javascript" src="bower_components/i18next/i18next.js"></script>
  <link rel="import" href="locales/fr/translation.json">
</head>
<body unresolved class="page-home w100 flexbox-v">
<template is="dom-bind" id="app">
  <div class="header-container">
    <header id="header" class="wrapper clearfix txtcenter">
      <h1 class="title"><img src="images/logo-header.png" alt="silverpeas"/></h1>
      <sp-connection-info login-page='/login.html' user="{{currentUser}}"></sp-connection-info>
      <sp-space-header-menu></sp-space-header-menu>
    </header>
  </div>
  <div class="main-container flexitem-fluid">
    <iron-pages attr-for-selected="data-route" selected="{{route}}">
      <paper-material data-route="home" elevation="1">
        <sp-home-page></sp-home-page>
      </paper-material>
      <paper-material data-route="space-home" elevation="1">
        <sp-space space-id="{{space.id}}"></sp-space>
      </paper-material>
      <paper-material data-route="instance-home" elevation="1">
        <sp-app-instance instance-id="[[instance.id]]"></sp-app-instance>
      </paper-material>
    </iron-pages>
    <!--<neon-animated-pages attr-for-selected="data-route" selected="{{route}}"
                         &entry-animation="fade-in-animation" exit-animation="fade-out-animation">
      <neon-animatable data-route="home" elevation="1">
        <sp-home-page></sp-home-page>
      </neon-animatable>
      <neon-animatable data-route="space-home" elevation="1">
        <sp-space space-id="{{params.id}}"></sp-space>
      </neon-animatable>
      <neon-animatable data-route="instance-home" elevation="1">
        <sp-app-instance instance-id="{{params.id}}"></sp-app-instance>
      </neon-animatable>
    </neon-animated-pages>-->
  </div>
  <paper-toast text="Hey !">
    Bienvenue <b><span>{{currentUser.firstName}}</span><span>{{currentUser.lastName}}</span></b>
  </paper-toast>
  <!-- #main-container -->
  <div class="footer-container pam">
    <footer class="wrapper">
      <div id="footerContent" data-i18n="[html]silverpeas.footer.copyright"></div>
    </footer>
  </div>
  <a id="transition" style="display: none"></a>
  <iron-a11y-announcer mode="off"></iron-a11y-announcer>
</template>
<script>
  (function(document) {
    'use strict';

    window.addEventListener('WebComponentsReady', function() {
      var app = document.querySelector('#app');

      // apply dynamically some style classes
      (function() {
        var header = document.getElementById("header");

        function scrolled() {
          var windowHeight = document.body.clientHeight, currentScroll = document.body.scrollTop ||
              document.documentElement.scrollTop;

          document.getElementById("header").className =
              (currentScroll >= 273) ? "wrapper clearfix txtcenter fixed" :
                  "wrapper clearfix txtcenter";
        }

        addEventListener("scroll", scrolled, false);
      })();

      // load routing rules.
      (function() {

        page('/spaces/:id', function(data) {
          console.log("space selected: " + data.params.id);
          app.space = data.params;
          app.route = 'space-home';
          app.fire('route-changed', {target : 'sp-space', id : app.space.id});
        });

        page('/instances/:id', function(data) {
          console.log("instance selected: " + data.params.id);
          app.instance = data.params;
          app.route = 'instance-home';
          app.fire('route-changed', {target : 'sp-app', id : app.instance.id});
        });

        page('*', function(data) {
          console.log("Unknown path, redirect to home");
          app.route = 'home';
          app.space = {};
          app.instance = {};
          app.fire('route-changed', {target : 'home', id : null});
        });

        // add #! before urls
        page({
          hashbang : true
        });

        page('/yocha.html', function() {
        });

        console.log("routing loaded!");
      })();

      document.querySelector('body').removeAttribute('unresolved');

      Polymer.dom(document.body).querySelector('h1').addEventListener('click', function(e) {
        document.location = "/yocha.html";
      });

      var i18nOptions = {
        lng : "fr",
        preload: ['en'],
        nsseparator : ':::',
        keyseparator : '::'
      };

      i18n.init(i18nOptions, function(t) {
        // Translate all data-i18n attribute inside DOM
        $(".page-home").i18n();
        // programatical access
        console.log("Loading json string " + t("silverpeas.footer.copyright"));
      });

      document.querySelector('paper-toast').show();

    });
  })(document);

</script>
</body>
</html>
